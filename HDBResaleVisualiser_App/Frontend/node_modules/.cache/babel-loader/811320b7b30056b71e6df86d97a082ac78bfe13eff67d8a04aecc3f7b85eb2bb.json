{"ast":null,"code":"import{useState}from\"react\";import{useNavigate}from\"react-router-dom\";import axiosInstance from\"../utils/axiosInstance\";// Ensure axiosInstance is used\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function LoginModal(_ref){let{isLoginOpen,setIsLoginOpen,setIsLoggedIn,setUsername}=_ref;const[username,setUsernameInput]=useState(\"\");const[password,setPassword]=useState(\"\");const[errorMessage,setErrorMessage]=useState(\"\");const navigate=useNavigate();const handleLogin=async()=>{if(username&&password){try{const response=await axiosInstance.post(\"login/\",{username,password});if(response.status===200){const{access,refresh}=response.data;// Store tokens in localStorage\nlocalStorage.setItem(\"access_token\",access);localStorage.setItem(\"refresh_token\",refresh);// Fetch and store the user's profile\nfetchUserProfile();alert(`Welcome, ${username}! You are now logged in.`);setIsLoginOpen(false);setIsLoggedIn(true);navigate(\"/\");// Redirect to homepage after login\n}}catch(error){if(error.response){if(error.response.status===401){setErrorMessage(\"Invalid username or password. Please try again.\");}else{setErrorMessage(error.response.data.detail||\"An unexpected error occurred.\");}}else{setErrorMessage(\"Network error. Please check your connection and try again.\");}}}else{setErrorMessage(\"Please enter both username and password.\");}};const fetchUserProfile=async()=>{try{const response=await axiosInstance.get(\"user-profile/\");const loggedInUsername=response.data.username;// ✅ Update HomePage state with the username\nsetUsername(loggedInUsername);localStorage.setItem(\"username\",loggedInUsername);}catch(error){console.error(\"Error fetching user profile:\",error);}};if(!isLoginOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-lg w-96\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4 text-center\",children:\"Login\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Username\",value:username,onChange:e=>setUsernameInput(e.target.value),className:\"w-full p-3 border border-gray-300 rounded mb-3\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"Password\",value:password,onChange:e=>setPassword(e.target.value),className:\"w-full p-3 border border-gray-300 rounded mb-3\"}),errorMessage&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-600 text-center mb-3\",children:errorMessage}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogin,className:\"w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700\",children:\"Login\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mt-4\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"text-red-600 hover:underline\",onClick:()=>{setIsLoginOpen(false);navigate(\"/signup\");// Navigate to signup page\n},children:\"Sign Up\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsLoginOpen(false),className:\"text-gray-600 hover:underline\",children:\"Continue as Guest\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-3 text-center\",children:/*#__PURE__*/_jsx(\"a\",{href:\"/forgot-password\",className:\"text-red-600 hover:underline\",children:\"Forgot Password?\"})})]})});}","map":{"version":3,"names":["useState","useNavigate","axiosInstance","jsx","_jsx","jsxs","_jsxs","LoginModal","_ref","isLoginOpen","setIsLoginOpen","setIsLoggedIn","setUsername","username","setUsernameInput","password","setPassword","errorMessage","setErrorMessage","navigate","handleLogin","response","post","status","access","refresh","data","localStorage","setItem","fetchUserProfile","alert","error","detail","get","loggedInUsername","console","className","children","type","placeholder","value","onChange","e","target","onClick","href"],"sources":["D:/SC2006/sc2006_project (3)/sc2006_project/src/login/LoginModal.js"],"sourcesContent":["import { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport axiosInstance from \"../utils/axiosInstance\"; // Ensure axiosInstance is used\n\nexport default function LoginModal({ isLoginOpen, setIsLoginOpen, setIsLoggedIn, setUsername }) {\n    const [username, setUsernameInput] = useState(\"\");\n    const [password, setPassword] = useState(\"\");\n    const [errorMessage, setErrorMessage] = useState(\"\");\n    const navigate = useNavigate();\n\n    const handleLogin = async () => {\n        if (username && password) {\n            try {\n                const response = await axiosInstance.post(\"login/\", {\n                    username,\n                    password,\n                });\n\n                if (response.status === 200) {\n                    const { access, refresh } = response.data;\n\n                    // Store tokens in localStorage\n                    localStorage.setItem(\"access_token\", access);\n                    localStorage.setItem(\"refresh_token\", refresh);\n\n                    // Fetch and store the user's profile\n                    fetchUserProfile();\n\n                    alert(`Welcome, ${username}! You are now logged in.`);\n                    setIsLoginOpen(false);\n                    setIsLoggedIn(true);\n                    navigate(\"/\"); // Redirect to homepage after login\n                }\n            } catch (error) {\n                if (error.response) {\n                    if (error.response.status === 401) {\n                        setErrorMessage(\"Invalid username or password. Please try again.\");\n                    } else {\n                        setErrorMessage(error.response.data.detail || \"An unexpected error occurred.\");\n                    }\n                } else {\n                    setErrorMessage(\"Network error. Please check your connection and try again.\");\n                }\n            }\n        } else {\n            setErrorMessage(\"Please enter both username and password.\");\n        }\n    };\n\n    const fetchUserProfile = async () => {\n        try {\n            const response = await axiosInstance.get(\"user-profile/\");\n            const loggedInUsername = response.data.username;\n            \n            // ✅ Update HomePage state with the username\n            setUsername(loggedInUsername);\n            localStorage.setItem(\"username\", loggedInUsername);\n        } catch (error) {\n            console.error(\"Error fetching user profile:\", error);\n        }\n    };\n\n    if (!isLoginOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50\">\n            <div className=\"bg-white p-6 rounded-lg shadow-lg w-96\">\n                <h2 className=\"text-2xl font-bold mb-4 text-center\">Login</h2>\n                <input\n                    type=\"text\"\n                    placeholder=\"Username\"\n                    value={username}\n                    onChange={(e) => setUsernameInput(e.target.value)}\n                    className=\"w-full p-3 border border-gray-300 rounded mb-3\"\n                />\n                <input\n                    type=\"password\"\n                    placeholder=\"Password\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    className=\"w-full p-3 border border-gray-300 rounded mb-3\"\n                />\n                {errorMessage && (\n                    <p className=\"text-red-600 text-center mb-3\">{errorMessage}</p>\n                )}\n                <button\n                    onClick={handleLogin}\n                    className=\"w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700\"\n                >\n                    Login\n                </button>\n\n                <div className=\"flex justify-between mt-4\">\n                    <button\n                        className=\"text-red-600 hover:underline\"\n                        onClick={() => {\n                            setIsLoginOpen(false);\n                            navigate(\"/signup\"); // Navigate to signup page\n                        }}\n                    >\n                        Sign Up\n                    </button>\n                    <button\n                        onClick={() => setIsLoginOpen(false)}\n                        className=\"text-gray-600 hover:underline\"\n                    >\n                        Continue as Guest\n                    </button>\n                </div>\n\n                <p className=\"mt-3 text-center\">\n                    <a href=\"/forgot-password\" className=\"text-red-600 hover:underline\">\n                        Forgot Password?\n                    </a>\n                </p>\n            </div>\n        </div>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}