{"ast":null,"code":"import{useState}from\"react\";import{useNavigate}from\"react-router-dom\";import axiosInstance from\"../utils/axiosInstance\";// ✅ Import axiosInstance\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function LoginModal(_ref){let{isLoginOpen,setIsLoginOpen,setIsLoggedIn,setUsername}=_ref;const[username,setUsernameInput]=useState(\"\");const[password,setPassword]=useState(\"\");const[errorMessage,setErrorMessage]=useState(\"\");const navigate=useNavigate();// ✅ Handle Login Request\nconst handleLogin=async()=>{if(username&&password){try{console.log(\"Attempting to login...\");const response=await axiosInstance.post(\"login/\",{username,password});console.log(\"Login API Response:\",response.data);// ✅ Debug log\nif(response.status===200){const{access,refresh}=response.data;// ✅ Store tokens in localStorage\nlocalStorage.setItem(\"access_token\",access);localStorage.setItem(\"refresh_token\",refresh);// ✅ Fetch and store the user's profile\nawait fetchUserProfile();alert(`Welcome, ${username}! You are now logged in.`);setIsLoginOpen(false);setIsLoggedIn(true);navigate(\"/\");// Redirect to homepage after login\n}}catch(error){var _error$response;console.error(\"Login failed:\",((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);// ✅ Debug log\nif(error.response){if(error.response.status===400||error.response.status===401){setErrorMessage(\"Invalid username or password. Please try again.\");}else{setErrorMessage(error.response.data.detail||\"An unexpected error occurred.\");}}else{setErrorMessage(\"Network error. Please check your connection and try again.\");}}}else{setErrorMessage(\"Please enter both username and password.\");}};// ✅ Fetch User Profile After Login\nconst fetchUserProfile=async()=>{try{const response=await axiosInstance.get(\"user-profile/\");console.log(\"User Profile Response:\",response.data);// ✅ Debug log\nconst loggedInUsername=response.data.username;// ✅ Update HomePage state with the username\nsetUsername(loggedInUsername);localStorage.setItem(\"username\",loggedInUsername);}catch(error){console.error(\"Error fetching user profile:\",error);}};if(!isLoginOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-lg w-96\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4 text-center\",children:\"Login\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Username\",value:username,onChange:e=>setUsernameInput(e.target.value),className:\"w-full p-3 border border-gray-300 rounded mb-3\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"Password\",value:password,onChange:e=>setPassword(e.target.value),className:\"w-full p-3 border border-gray-300 rounded mb-3\"}),errorMessage&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-600 text-center mb-3\",children:errorMessage}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogin,className:\"w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700\",children:\"Login\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mt-4\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"text-red-600 hover:underline\",onClick:()=>{setIsLoginOpen(false);navigate(\"/signup\");// Navigate to signup page\n},children:\"Sign Up\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsLoginOpen(false),className:\"text-gray-600 hover:underline\",children:\"Continue as Guest\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-3 text-center\",children:/*#__PURE__*/_jsx(\"a\",{href:\"/forgot-password\",className:\"text-red-600 hover:underline\",children:\"Forgot Password?\"})})]})});}","map":{"version":3,"names":["useState","useNavigate","axiosInstance","jsx","_jsx","jsxs","_jsxs","LoginModal","_ref","isLoginOpen","setIsLoginOpen","setIsLoggedIn","setUsername","username","setUsernameInput","password","setPassword","errorMessage","setErrorMessage","navigate","handleLogin","console","log","response","post","data","status","access","refresh","localStorage","setItem","fetchUserProfile","alert","error","_error$response","message","detail","get","loggedInUsername","className","children","type","placeholder","value","onChange","e","target","onClick","href"],"sources":["D:/SC2006/sc2006_project (3)/sc2006_project/src/login/LoginModal.js"],"sourcesContent":["import { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport axiosInstance from \"../utils/axiosInstance\"; // ✅ Import axiosInstance\n\nexport default function LoginModal({ isLoginOpen, setIsLoginOpen, setIsLoggedIn, setUsername }) {\n    const [username, setUsernameInput] = useState(\"\");\n    const [password, setPassword] = useState(\"\");\n    const [errorMessage, setErrorMessage] = useState(\"\");\n    const navigate = useNavigate();\n\n    // ✅ Handle Login Request\n    const handleLogin = async () => {\n        if (username && password) {\n            try {\n                console.log(\"Attempting to login...\");\n\n                const response = await axiosInstance.post(\"login/\", { username, password });\n\n                console.log(\"Login API Response:\", response.data);  // ✅ Debug log\n\n                if (response.status === 200) {\n                    const { access, refresh } = response.data;\n\n                    // ✅ Store tokens in localStorage\n                    localStorage.setItem(\"access_token\", access);\n                    localStorage.setItem(\"refresh_token\", refresh);\n\n                    // ✅ Fetch and store the user's profile\n                    await fetchUserProfile();\n\n                    alert(`Welcome, ${username}! You are now logged in.`);\n                    setIsLoginOpen(false);\n                    setIsLoggedIn(true);\n                    navigate(\"/\"); // Redirect to homepage after login\n                }\n            } catch (error) {\n                console.error(\"Login failed:\", error.response?.data || error.message);  // ✅ Debug log\n\n                if (error.response) {\n                    if (error.response.status === 400 || error.response.status === 401) {\n                        setErrorMessage(\"Invalid username or password. Please try again.\");\n                    } else {\n                        setErrorMessage(error.response.data.detail || \"An unexpected error occurred.\");\n                    }\n                } else {\n                    setErrorMessage(\"Network error. Please check your connection and try again.\");\n                }\n            }\n        } else {\n            setErrorMessage(\"Please enter both username and password.\");\n        }\n    };\n\n    // ✅ Fetch User Profile After Login\n    const fetchUserProfile = async () => {\n        try {\n            const response = await axiosInstance.get(\"user-profile/\");\n            console.log(\"User Profile Response:\", response.data);  // ✅ Debug log\n\n            const loggedInUsername = response.data.username;\n\n            // ✅ Update HomePage state with the username\n            setUsername(loggedInUsername);\n            localStorage.setItem(\"username\", loggedInUsername);\n        } catch (error) {\n            console.error(\"Error fetching user profile:\", error);\n        }\n    };\n\n    if (!isLoginOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50\">\n            <div className=\"bg-white p-6 rounded-lg shadow-lg w-96\">\n                <h2 className=\"text-2xl font-bold mb-4 text-center\">Login</h2>\n                <input\n                    type=\"text\"\n                    placeholder=\"Username\"\n                    value={username}\n                    onChange={(e) => setUsernameInput(e.target.value)}\n                    className=\"w-full p-3 border border-gray-300 rounded mb-3\"\n                />\n                <input\n                    type=\"password\"\n                    placeholder=\"Password\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    className=\"w-full p-3 border border-gray-300 rounded mb-3\"\n                />\n                {errorMessage && (\n                    <p className=\"text-red-600 text-center mb-3\">{errorMessage}</p>\n                )}\n                <button\n                    onClick={handleLogin}\n                    className=\"w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700\"\n                >\n                    Login\n                </button>\n\n                <div className=\"flex justify-between mt-4\">\n                    <button\n                        className=\"text-red-600 hover:underline\"\n                        onClick={() => {\n                            setIsLoginOpen(false);\n                            navigate(\"/signup\"); // Navigate to signup page\n                        }}\n                    >\n                        Sign Up\n                    </button>\n                    <button\n                        onClick={() => setIsLoginOpen(false)}\n                        className=\"text-gray-600 hover:underline\"\n                    >\n                        Continue as Guest\n                    </button>\n                </div>\n\n                <p className=\"mt-3 text-center\">\n                    <a href=\"/forgot-password\" className=\"text-red-600 hover:underline\">\n                        Forgot Password?\n                    </a>\n                </p>\n            </div>\n        </div>\n    );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}